{% extends 'base.html' %}

{% block content %}
{% include 'filter_form_drop.html' %}
<!--  -->
<div class="card container-info"> 
  <table class="table table-striped table-hover">
    <tr>
      <td colspan="2">Кол-во контрактов соответствующих фильтру</td>
      <td>{{ contracts|length }}</td>
    </tr>
    </table>
    </div>
    <div class="card container-info"> 
      <table class="table table-striped table-hover">
        <thead>
        </thead>
        <tbody>
          
          <tr>
            <td><b>Завоз</b></td>
            <td>Суммарный вес</td>
            <td>{{ income_stats.weight }}</td>
          </tr>
          <tr>
            <td></td>
            <td>Суммарная стоимость</td>
            <td>{{ income_stats.cost }}</td>
          </tr>
          <tr>
            <td></td>
            <td>Из них оплачено</td>
            <td>{{ income_stats.payments }}</td>
          </tr>
          {% for manager, amount in income_stats.bonuses.items %}
          <tr>
            <td><b>Премиальные</b></td>
            <td>Доля {{ manager }}</td>
            <td>{{ amount }}</td>
          </tr>
          {% endfor %}
        </tbody>
        </table>
        </div>
        <div class="card container-info"> 
        <table class="table table-striped table-hover">
        <tbody>
        <tr>
          <td><b>Отгрузки</b></td>
          <td>Суммарный вес</td>
          <td>{{ outcome_stats.weight }}</td>
        </tr>
        <tr>
          <td></td>
          <td>Себестоимость</td>
          <td>{{ outcome_stats.expenses }}</td>
        </tr>
        <tr>
          <td></td>
          <td>Суммарная стоимость</td>
          <td>{{ outcome_stats.cost }}</td>
        </tr>
        <tr>
          <td></td>
          <td>Из них оплачено</td>
          <td>{{ outcome_stats.payments }}</td>
        </tr>
        <tr>
          <td></td>
          <td>Планируемый доход</td>
          <td>{{ outcome_stats.expected }}</td>
        </tr>
        {% for manager, amount in outcome_stats.bonuses.items %}
        <tr>
          <td><b>Премиальные</b></td>
          <td>Доля {{ manager }}</td>
          <td>{{ amount }}</td>
        </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
    
    <div class="container-content">
      <!--  -->
      <div class="pagination-upper">
        <p>{% include 'pagination.html' %}</p>
      </div>
      <!--  -->
        {% for contract in contracts %}
        
          <div class="
          {% if contract.reserved and contract.executed and contract.paid %}
          card bg-success-subtle mb-1
          {% elif contract.reserved and contract.executed and not contract.paid %}
          card bg-danger-subtle mb-1
          {% elif contract.reserved and not contract.executed and contract.paid %}
          card bg-primary-subtle mb-1
          {% elif contract.reserved and not contract.executed and not contract.paid %}
          card bg-warning-subtle mb-1
          {% else %}
          card bg-secondary-subtle mb-1
          {% endif %}">
            <div class="card-text"><a href="{% url 'contracts:contract' contract.pk %}">
            #{{ contract.pk }}--
              {{ contract.date_plan|date:"d M Y" }}--
              {% if contract.contract_type == 'Покупка' %}
              <b class="text-danger">Завоз</b>
              {% else %}
              {% endif %}
               {{ contract.contractor.name }} 
              {{ contract.reserved|yesno:"1,0" }}|{{ contract.executed|yesno:"1,0" }}|{{ contract.paid|yesno:"1,0" }}
              {{ contract.total_weight|default:0 }}-
              {{ contract.total_sum|default:0 }}/
              {{ contract.total_payments|default:0 }}
            </a>
            </div>
          </div>

        {% endfor %}
      <!--  -->
      <div class="pagination-lower">
        <p>{% include 'pagination.html' %}</p>
      </div>
    </div>
{% endblock %}

